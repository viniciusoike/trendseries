<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Advanced Trend Extraction Methods • trendseries</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Advanced Trend Extraction Methods">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">trendseries</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/trendseries.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/advanced-methods.html">Advanced Trend Extraction Methods</a></li>
    <li><a class="dropdown-item" href="../articles/economic-filters.html">Economic Filters for Business Cycle Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/moving-averages.html">Moving Averages for Trend Analysis</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/viniciusoike/trendseries/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Advanced Trend Extraction Methods</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/viniciusoike/trendseries/blob/main/vignettes/advanced-methods.Rmd" class="external-link"><code>vignettes/advanced-methods.Rmd</code></a></small>
      <div class="d-none name"><code>advanced-methods.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/viniciusoike/trendseries" class="external-link">trendseries</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"electric"</span>, <span class="st">"vehicles"</span>, <span class="st">"ibcbr"</span>, package <span class="op">=</span> <span class="st">"trendseries"</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette covers advanced trend extraction methods that go beyond
simple moving averages and standard economic filters. These methods are
designed for specific situations:</p>
<ul>
<li>
<strong>STL decomposition</strong>: Seasonal data with complex
patterns</li>
<li>
<strong>Kalman filter</strong>: Optimal smoothing with state-space
models</li>
<li>
<strong>Savitzky-Golay filter</strong>: Preserving peaks and local
features</li>
<li>
<strong>Spline smoothing</strong>: Highly flexible nonparametric
trends</li>
<li>
<strong>LOESS</strong>: Locally adaptive smoothing</li>
</ul>
<div class="section level3">
<h3 id="when-to-use-advanced-methods">When to Use Advanced Methods<a class="anchor" aria-label="anchor" href="#when-to-use-advanced-methods"></a>
</h3>
<p>Use these methods when: - Your data has seasonal patterns (STL) - You
need optimal statistical properties (Kalman) - Local features like peaks
matter (Savitzky-Golay) - The trend is highly nonlinear (splines, LOESS)
- Standard methods don’t capture the pattern you see</p>
</div>
</div>
<div class="section level2">
<h2 id="stl-decomposition-handling-seasonality">STL Decomposition: Handling Seasonality<a class="anchor" aria-label="anchor" href="#stl-decomposition-handling-seasonality"></a>
</h2>
<p>STL (Seasonal-Trend decomposition using LOESS) is ideal for data with
<strong>regular seasonal patterns</strong>. It decomposes a time series
into three components: seasonal, trend, and remainder.</p>
<div class="section level3">
<h3 id="basic-stl-example">Basic STL Example<a class="anchor" aria-label="anchor" href="#basic-stl-example"></a>
</h3>
<p>Let’s use electricity consumption data, which has clear seasonal
patterns:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get recent electricity data</span></span>
<span><span class="va">electric_recent</span> <span class="op">&lt;-</span> <span class="va">electric</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_tail</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">72</span><span class="op">)</span>  <span class="co"># Last 6 years</span></span>
<span></span>
<span><span class="co"># Apply STL decomposition</span></span>
<span><span class="va">electric_stl</span> <span class="op">&lt;-</span> <span class="va">electric_recent</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/augment_trends.html">augment_trends</a></span><span class="op">(</span></span>
<span>    value_col <span class="op">=</span> <span class="st">"electric"</span>,</span>
<span>    methods <span class="op">=</span> <span class="st">"stl"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># STL returns the trend component</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">electric_stl</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   date       electric trend_stl</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2019-08-01    <span style="text-decoration: underline;">10</span>987    <span style="text-decoration: underline;">11</span>709.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2019-09-01    <span style="text-decoration: underline;">11</span>379    <span style="text-decoration: underline;">11</span>759.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 2019-10-01    <span style="text-decoration: underline;">11</span>973    <span style="text-decoration: underline;">11</span>810.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 2019-11-01    <span style="text-decoration: underline;">12</span>424    <span style="text-decoration: underline;">11</span>865.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 2019-12-01    <span style="text-decoration: underline;">12</span>201    <span style="text-decoration: underline;">11</span>921.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 2020-01-01    <span style="text-decoration: underline;">12</span>909    <span style="text-decoration: underline;">11</span>981.</span></span></code></pre></div>
<p>Visualize the decomposition:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate seasonal and remainder components</span></span>
<span><span class="va">electric_decomp</span> <span class="op">&lt;-</span> <span class="va">electric_stl</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    seasonal <span class="op">=</span> <span class="va">electric</span> <span class="op">-</span> <span class="va">trend_stl</span>,  <span class="co"># Approximate seasonal (for visualization)</span></span>
<span>    trend <span class="op">=</span> <span class="va">trend_stl</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot original and trend</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">electric_decomp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">electric</span>, <span class="va">trend</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">electric</span>, <span class="va">trend</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"series"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>series <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">series</span> <span class="op">==</span> <span class="st">"electric"</span>, <span class="st">"Original"</span>, <span class="st">"Trend"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">series</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Electricity Consumption: STL Trend"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Trend component removes seasonal patterns"</span>,</span>
<span>    x <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"GWh"</span>,</span>
<span>    color <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p1</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced-methods_files/figure-html/stl-plot-1.png" width="768"></p>
<p>Notice how the STL trend is much smoother than the original data
because it has removed the seasonal fluctuations.</p>
</div>
<div class="section level3">
<h3 id="comparing-stl-with-hp-filter-on-seasonal-data">Comparing STL with HP Filter on Seasonal Data<a class="anchor" aria-label="anchor" href="#comparing-stl-with-hp-filter-on-seasonal-data"></a>
</h3>
<p>Let’s compare STL with the HP filter on the same seasonal data:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Apply both methods</span></span>
<span><span class="va">electric_comparison</span> <span class="op">&lt;-</span> <span class="va">electric_recent</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/augment_trends.html">augment_trends</a></span><span class="op">(</span></span>
<span>    value_col <span class="op">=</span> <span class="st">"electric"</span>,</span>
<span>    methods <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"stl"</span>, <span class="st">"hp"</span>, <span class="st">"ma"</span><span class="op">)</span>,</span>
<span>    window <span class="op">=</span> <span class="fl">12</span>  <span class="co"># 12-month window for MA</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot comparison</span></span>
<span><span class="va">electric_comparison</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">electric</span>, <span class="va">trend_stl</span>, <span class="va">trend_hp</span>, <span class="va">trend_ma</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">electric</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"trend_"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"method"</span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"value"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    method <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"electric"</span> <span class="op">~</span> <span class="st">"Original"</span>,</span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"trend_stl"</span> <span class="op">~</span> <span class="st">"STL"</span>,</span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"trend_hp"</span> <span class="op">~</span> <span class="st">"HP Filter"</span>,</span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"trend_ma"</span> <span class="op">~</span> <span class="st">"12-month MA"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Comparing Methods on Seasonal Data"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"STL explicitly handles seasonality"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Date"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"GWh"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Method"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced-methods_files/figure-html/stl-vs-hp-1.png" width="768"></p>
<p>All three methods remove seasonality to some degree, but STL is
specifically designed for this purpose.</p>
</div>
<div class="section level3">
<h3 id="when-to-use-stl">When to Use STL<a class="anchor" aria-label="anchor" href="#when-to-use-stl"></a>
</h3>
<p><strong>Use STL when</strong>: - Data has clear monthly or quarterly
seasonal patterns - Seasonality strength varies over time - You want to
separately analyze seasonal and trend components</p>
<p><strong>Don’t use STL when</strong>: - Data has no seasonality (use
HP or MA instead) - Seasonal pattern is irregular (try other methods) -
You have very short time series (need at least 2 full cycles)</p>
</div>
</div>
<div class="section level2">
<h2 id="kalman-filter-optimal-statistical-smoothing">Kalman Filter: Optimal Statistical Smoothing<a class="anchor" aria-label="anchor" href="#kalman-filter-optimal-statistical-smoothing"></a>
</h2>
<p>The Kalman filter provides <strong>statistically optimal</strong>
smoothing under certain assumptions. It’s based on state-space models
and is widely used in engineering and finance.</p>
<div class="section level3">
<h3 id="basic-kalman-smoothing">Basic Kalman Smoothing<a class="anchor" aria-label="anchor" href="#basic-kalman-smoothing"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Apply Kalman filter to IBC-Br data</span></span>
<span><span class="va">ibcbr_recent</span> <span class="op">&lt;-</span> <span class="va">ibcbr</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_tail</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">120</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ibcbr_kalman</span> <span class="op">&lt;-</span> <span class="va">ibcbr_recent</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/augment_trends.html">augment_trends</a></span><span class="op">(</span></span>
<span>    value_col <span class="op">=</span> <span class="st">"ibcbr"</span>,</span>
<span>    methods <span class="op">=</span> <span class="st">"kalman"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare with HP filter</span></span>
<span><span class="va">ibcbr_comparison</span> <span class="op">&lt;-</span> <span class="va">ibcbr_recent</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/augment_trends.html">augment_trends</a></span><span class="op">(</span></span>
<span>    value_col <span class="op">=</span> <span class="st">"ibcbr"</span>,</span>
<span>    methods <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"kalman"</span>, <span class="st">"hp"</span>, <span class="st">"loess"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="va">ibcbr_comparison</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">ibcbr</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"trend_"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ibcbr</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"trend_"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"method"</span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"value"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    method <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"ibcbr"</span> <span class="op">~</span> <span class="st">"Original"</span>,</span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"trend_kalman"</span> <span class="op">~</span> <span class="st">"Kalman"</span>,</span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"trend_hp"</span> <span class="op">~</span> <span class="st">"HP Filter"</span>,</span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"trend_loess"</span> <span class="op">~</span> <span class="st">"LOESS"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Kalman Filter vs Other Methods"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"IBC-Br Economic Activity Index"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Date"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Index"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Method"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced-methods_files/figure-html/kalman-basic-1.png" width="768"></p>
</div>
<div class="section level3">
<h3 id="adjusting-kalman-smoothing">Adjusting Kalman Smoothing<a class="anchor" aria-label="anchor" href="#adjusting-kalman-smoothing"></a>
</h3>
<p>You can control the smoothness with the <code>smoothing</code>
parameter (higher values = more smoothing):</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Try different smoothing levels</span></span>
<span><span class="va">smoothing_levels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1.0</span>, <span class="fl">2.0</span>, <span class="fl">5.0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vehicles_recent</span> <span class="op">&lt;-</span> <span class="va">vehicles</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_tail</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">60</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vehicles_kalman</span> <span class="op">&lt;-</span> <span class="va">vehicles_recent</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">s</span> <span class="kw">in</span> <span class="va">smoothing_levels</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">temp</span> <span class="op">&lt;-</span> <span class="va">vehicles_recent</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/augment_trends.html">augment_trends</a></span><span class="op">(</span>value_col <span class="op">=</span> <span class="st">"vehicles"</span>, methods <span class="op">=</span> <span class="st">"kalman"</span>, smoothing <span class="op">=</span> <span class="va">s</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">trend_kalman</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"kalman_"</span>, <span class="va">s</span><span class="op">)</span></span>
<span>  <span class="va">vehicles_kalman</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="va">vehicles_kalman</span>, <span class="va">temp</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="va">vehicles_kalman</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">vehicles</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"kalman_"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">vehicles</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"kalman_"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"method"</span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"value"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    method <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"vehicles"</span> <span class="op">~</span> <span class="st">"Original"</span>,</span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"kalman_0.5"</span> <span class="op">~</span> <span class="st">"Light smoothing"</span>,</span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"kalman_1"</span> <span class="op">~</span> <span class="st">"Medium smoothing"</span>,</span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"kalman_2"</span> <span class="op">~</span> <span class="st">"Heavy smoothing"</span>,</span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"kalman_5"</span> <span class="op">~</span> <span class="st">"Very heavy smoothing"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Kalman Filter with Different Smoothing Levels"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Higher values produce smoother trends"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Date"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Production (thousands)"</span>,</span>
<span>    color <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced-methods_files/figure-html/kalman-smoothing-1.png" width="768"></p>
<p><strong>When to use Kalman</strong>: - You want statistically
principled smoothing - Data is noisy but has a clear underlying trend -
You need real-time filtering (Kalman works well with streaming data)</p>
</div>
</div>
<div class="section level2">
<h2 id="savitzky-golay-filter-preserving-features">Savitzky-Golay Filter: Preserving Features<a class="anchor" aria-label="anchor" href="#savitzky-golay-filter-preserving-features"></a>
</h2>
<p>The Savitzky-Golay (SG) filter is designed to <strong>preserve local
features</strong> like peaks and valleys while smoothing. It fits local
polynomials to the data.</p>
<div class="section level3">
<h3 id="basic-sg-example">Basic SG Example<a class="anchor" aria-label="anchor" href="#basic-sg-example"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Apply SG filter to vehicle production</span></span>
<span><span class="va">vehicles_sg</span> <span class="op">&lt;-</span> <span class="va">vehicles_recent</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/augment_trends.html">augment_trends</a></span><span class="op">(</span></span>
<span>    value_col <span class="op">=</span> <span class="st">"vehicles"</span>,</span>
<span>    methods <span class="op">=</span> <span class="st">"sg"</span>,</span>
<span>    window <span class="op">=</span> <span class="fl">9</span>  <span class="co"># Must be odd number</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare SG with MA</span></span>
<span><span class="va">vehicles_comparison</span> <span class="op">&lt;-</span> <span class="va">vehicles_recent</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/augment_trends.html">augment_trends</a></span><span class="op">(</span></span>
<span>    value_col <span class="op">=</span> <span class="st">"vehicles"</span>,</span>
<span>    methods <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sg"</span>, <span class="st">"ma"</span>, <span class="st">"loess"</span><span class="op">)</span>,</span>
<span>    window <span class="op">=</span> <span class="fl">9</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="va">vehicles_comparison</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">vehicles</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"trend_"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">vehicles</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"trend_"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"method"</span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"value"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    method <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"vehicles"</span> <span class="op">~</span> <span class="st">"Original"</span>,</span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"trend_sg"</span> <span class="op">~</span> <span class="st">"Savitzky-Golay"</span>,</span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"trend_ma"</span> <span class="op">~</span> <span class="st">"Moving Average"</span>,</span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"trend_loess"</span> <span class="op">~</span> <span class="st">"LOESS"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Savitzky-Golay vs Other Smoothers"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"SG preserves peaks better than simple MA"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Date"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Production (thousands)"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Method"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced-methods_files/figure-html/sg-basic-1.png" width="768"></p>
<p>Notice how SG preserves peaks and valleys better than the simple
moving average.</p>
</div>
<div class="section level3">
<h3 id="polynomial-order">Polynomial Order<a class="anchor" aria-label="anchor" href="#polynomial-order"></a>
</h3>
<p>You can adjust the polynomial order (higher order = more
flexible):</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Try different polynomial orders</span></span>
<span><span class="va">vehicles_sg_poly</span> <span class="op">&lt;-</span> <span class="va">vehicles_recent</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/augment_trends.html">augment_trends</a></span><span class="op">(</span></span>
<span>    value_col <span class="op">=</span> <span class="st">"vehicles"</span>,</span>
<span>    methods <span class="op">=</span> <span class="st">"sg"</span>,</span>
<span>    window <span class="op">=</span> <span class="fl">9</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sg_poly_order <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>sg_order2 <span class="op">=</span> <span class="va">trend_sg</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vehicles_sg_poly</span> <span class="op">&lt;-</span> <span class="va">vehicles_sg_poly</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/augment_trends.html">augment_trends</a></span><span class="op">(</span></span>
<span>    value_col <span class="op">=</span> <span class="st">"vehicles"</span>,</span>
<span>    methods <span class="op">=</span> <span class="st">"sg"</span>,</span>
<span>    window <span class="op">=</span> <span class="fl">9</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sg_poly_order <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>sg_order3 <span class="op">=</span> <span class="va">trend_sg</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vehicles_sg_poly</span> <span class="op">&lt;-</span> <span class="va">vehicles_sg_poly</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/augment_trends.html">augment_trends</a></span><span class="op">(</span></span>
<span>    value_col <span class="op">=</span> <span class="st">"vehicles"</span>,</span>
<span>    methods <span class="op">=</span> <span class="st">"sg"</span>,</span>
<span>    window <span class="op">=</span> <span class="fl">9</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sg_poly_order <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="va">vehicles_sg_poly</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">vehicles</span>, <span class="va">sg_order2</span>, <span class="va">sg_order3</span>, <span class="va">trend_sg</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">vehicles</span>, <span class="va">sg_order2</span>, <span class="va">sg_order3</span>, <span class="va">trend_sg</span><span class="op">)</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"method"</span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"value"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    method <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"vehicles"</span> <span class="op">~</span> <span class="st">"Original"</span>,</span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"sg_order2"</span> <span class="op">~</span> <span class="st">"Order 2 (quadratic)"</span>,</span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"sg_order3"</span> <span class="op">~</span> <span class="st">"Order 3 (cubic)"</span>,</span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"trend_sg"</span> <span class="op">~</span> <span class="st">"Order 4"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Savitzky-Golay with Different Polynomial Orders"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Higher orders preserve more detail"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Date"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Production (thousands)"</span>,</span>
<span>    color <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced-methods_files/figure-html/sg-poly-1.png" width="768"></p>
<p><strong>When to use Savitzky-Golay</strong>: - Peaks and valleys in
the data are meaningful - You want smoothing without losing local
structure - Data is relatively smooth (not too noisy)</p>
</div>
</div>
<div class="section level2">
<h2 id="loess-locally-adaptive-smoothing">LOESS: Locally Adaptive Smoothing<a class="anchor" aria-label="anchor" href="#loess-locally-adaptive-smoothing"></a>
</h2>
<p>LOESS (LOcally Estimated Scatterplot Smoothing) fits local weighted
regressions. It’s very flexible and adapts to local data patterns.</p>
<div class="section level3">
<h3 id="basic-loess">Basic LOESS<a class="anchor" aria-label="anchor" href="#basic-loess"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Apply LOESS to IBC-Br</span></span>
<span><span class="va">ibcbr_loess</span> <span class="op">&lt;-</span> <span class="va">ibcbr_recent</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/augment_trends.html">augment_trends</a></span><span class="op">(</span></span>
<span>    value_col <span class="op">=</span> <span class="st">"ibcbr"</span>,</span>
<span>    methods <span class="op">=</span> <span class="st">"loess"</span>,</span>
<span>    smoothing <span class="op">=</span> <span class="fl">0.2</span>  <span class="co"># Span parameter (0-1)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="va">ibcbr_loess</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">ibcbr</span>, <span class="va">trend_loess</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ibcbr</span>, <span class="va">trend_loess</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"series"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>series <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">series</span> <span class="op">==</span> <span class="st">"ibcbr"</span>, <span class="st">"Original"</span>, <span class="st">"LOESS Trend"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">series</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"LOESS Smoothing"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Locally adaptive polynomial regression"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Date"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Index"</span>,</span>
<span>    color <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced-methods_files/figure-html/loess-basic-1.png" width="768"></p>
</div>
<div class="section level3">
<h3 id="adjusting-the-span-parameter">Adjusting the Span Parameter<a class="anchor" aria-label="anchor" href="#adjusting-the-span-parameter"></a>
</h3>
<p>The span parameter controls smoothness (0-1, where larger =
smoother):</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Try different spans</span></span>
<span><span class="va">spans</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.7</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ibcbr_spans</span> <span class="op">&lt;-</span> <span class="va">ibcbr_recent</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">span</span> <span class="kw">in</span> <span class="va">spans</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">temp</span> <span class="op">&lt;-</span> <span class="va">ibcbr_recent</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/augment_trends.html">augment_trends</a></span><span class="op">(</span>value_col <span class="op">=</span> <span class="st">"ibcbr"</span>, methods <span class="op">=</span> <span class="st">"loess"</span>, smoothing <span class="op">=</span> <span class="va">span</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">trend_loess</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"loess_"</span>, <span class="va">span</span><span class="op">)</span></span>
<span>  <span class="va">ibcbr_spans</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="va">ibcbr_spans</span>, <span class="va">temp</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="va">ibcbr_spans</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">ibcbr</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"loess_"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ibcbr</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"loess_"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"method"</span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"value"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    method <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"ibcbr"</span> <span class="op">~</span> <span class="st">"Original"</span>,</span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"loess_0.1"</span> <span class="op">~</span> <span class="st">"Span = 0.1 (flexible)"</span>,</span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"loess_0.2"</span> <span class="op">~</span> <span class="st">"Span = 0.2"</span>,</span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"loess_0.4"</span> <span class="op">~</span> <span class="st">"Span = 0.4"</span>,</span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"loess_0.7"</span> <span class="op">~</span> <span class="st">"Span = 0.7 (smooth)"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"LOESS with Different Span Parameters"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Larger span = smoother trend"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Date"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Index"</span>,</span>
<span>    color <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced-methods_files/figure-html/loess-span-1.png" width="768"></p>
<p><strong>Recommended span values</strong>: - Flexible trend: 0.1 - 0.2
- Balanced: 0.2 - 0.4 - Smooth: 0.5 - 0.75</p>
<p><strong>When to use LOESS</strong>: - Trend is nonlinear and complex
- You want data-adaptive smoothing - Sample size is moderate (LOESS can
be slow on very large datasets)</p>
</div>
</div>
<div class="section level2">
<h2 id="spline-smoothing-maximum-flexibility">Spline Smoothing: Maximum Flexibility<a class="anchor" aria-label="anchor" href="#spline-smoothing-maximum-flexibility"></a>
</h2>
<p>Splines provide very flexible smoothing by fitting piecewise
polynomials:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Apply spline smoothing</span></span>
<span><span class="va">vehicles_spline</span> <span class="op">&lt;-</span> <span class="va">vehicles_recent</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/augment_trends.html">augment_trends</a></span><span class="op">(</span></span>
<span>    value_col <span class="op">=</span> <span class="st">"vehicles"</span>,</span>
<span>    methods <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"spline"</span>, <span class="st">"loess"</span>, <span class="st">"hp"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="va">vehicles_spline</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">vehicles</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"trend_"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">vehicles</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"trend_"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"method"</span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"value"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    method <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"vehicles"</span> <span class="op">~</span> <span class="st">"Original"</span>,</span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"trend_spline"</span> <span class="op">~</span> <span class="st">"Spline"</span>,</span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"trend_loess"</span> <span class="op">~</span> <span class="st">"LOESS"</span>,</span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"trend_hp"</span> <span class="op">~</span> <span class="st">"HP Filter"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Spline Smoothing vs Other Methods"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Splines are very flexible"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Date"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Production (thousands)"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Method"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced-methods_files/figure-html/spline-basic-1.png" width="768"></p>
<p><strong>When to use splines</strong>: - You need maximum flexibility
- Trend has complex, changing curvature - You don’t need to explain the
method (it’s somewhat of a “black box”)</p>
</div>
<div class="section level2">
<h2 id="combining-multiple-methods">Combining Multiple Methods<a class="anchor" aria-label="anchor" href="#combining-multiple-methods"></a>
</h2>
<p>Often the best approach is to compare several methods:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Apply many methods to the same data</span></span>
<span><span class="va">multi_method</span> <span class="op">&lt;-</span> <span class="va">ibcbr_recent</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/augment_trends.html">augment_trends</a></span><span class="op">(</span></span>
<span>    value_col <span class="op">=</span> <span class="st">"ibcbr"</span>,</span>
<span>    methods <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hp"</span>, <span class="st">"stl"</span>, <span class="st">"kalman"</span>, <span class="st">"loess"</span>, <span class="st">"spline"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate median trend across methods</span></span>
<span><span class="va">multi_method</span> <span class="op">&lt;-</span> <span class="va">multi_method</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html" class="external-link">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    trend_median <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">trend_hp</span>, <span class="va">trend_stl</span>, <span class="va">trend_kalman</span>,</span>
<span>                           <span class="va">trend_loess</span>, <span class="va">trend_spline</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="va">multi_method</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">ibcbr</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"trend_"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ibcbr</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"trend_"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"method"</span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"value"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    method <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"ibcbr"</span> <span class="op">~</span> <span class="st">"Original"</span>,</span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"trend_hp"</span> <span class="op">~</span> <span class="st">"HP"</span>,</span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"trend_stl"</span> <span class="op">~</span> <span class="st">"STL"</span>,</span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"trend_kalman"</span> <span class="op">~</span> <span class="st">"Kalman"</span>,</span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"trend_loess"</span> <span class="op">~</span> <span class="st">"LOESS"</span>,</span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"trend_spline"</span> <span class="op">~</span> <span class="st">"Spline"</span>,</span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"trend_median"</span> <span class="op">~</span> <span class="st">"Median of All"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    is_median <span class="op">=</span> <span class="va">method</span> <span class="op">==</span> <span class="st">"Median of All"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">method</span>, linewidth <span class="op">=</span> <span class="va">is_median</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_linewidth_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.6</span>, <span class="fl">1.5</span><span class="op">)</span>, guide <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Ensemble of Trend Methods"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Median trend (thick line) combines multiple methods"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Date"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Index"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Method"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced-methods_files/figure-html/method-ensemble-1.png" width="768"></p>
<p>The median trend can be more robust than any single method.</p>
</div>
<div class="section level2">
<h2 id="practical-application-end-of-sample-problem">Practical Application: End-of-Sample Problem<a class="anchor" aria-label="anchor" href="#practical-application-end-of-sample-problem"></a>
</h2>
<p>A common issue with trend extraction is behavior at the end of the
sample (most recent data). Different methods handle this
differently:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Focus on the last year of data</span></span>
<span><span class="va">recent_12m</span> <span class="op">&lt;-</span> <span class="va">ibcbr</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_tail</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">24</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Apply multiple methods</span></span>
<span><span class="va">end_sample</span> <span class="op">&lt;-</span> <span class="va">recent_12m</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/augment_trends.html">augment_trends</a></span><span class="op">(</span></span>
<span>    value_col <span class="op">=</span> <span class="st">"ibcbr"</span>,</span>
<span>    methods <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hp"</span>, <span class="st">"kalman"</span>, <span class="st">"loess"</span>, <span class="st">"ma"</span><span class="op">)</span>,</span>
<span>    window <span class="op">=</span> <span class="fl">6</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Highlight the last 6 observations</span></span>
<span><span class="va">end_sample</span> <span class="op">&lt;-</span> <span class="va">end_sample</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>recent <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">18</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot with emphasis on recent period</span></span>
<span><span class="va">end_sample</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">ibcbr</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"trend_"</span><span class="op">)</span>, <span class="va">recent</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ibcbr</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"trend_"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"method"</span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"value"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    method <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"ibcbr"</span> <span class="op">~</span> <span class="st">"Original"</span>,</span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"trend_hp"</span> <span class="op">~</span> <span class="st">"HP Filter"</span>,</span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"trend_kalman"</span> <span class="op">~</span> <span class="st">"Kalman"</span>,</span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"trend_loess"</span> <span class="op">~</span> <span class="st">"LOESS"</span>,</span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"trend_ma"</span> <span class="op">~</span> <span class="st">"Moving Average"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">end_sample</span><span class="op">$</span><span class="va">date</span><span class="op">[</span><span class="fl">19</span><span class="op">]</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="va">end_sample</span><span class="op">$</span><span class="va">date</span><span class="op">[</span><span class="fl">19</span><span class="op">]</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">end_sample</span><span class="op">$</span><span class="va">ibcbr</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>           label <span class="op">=</span> <span class="st">"Last 6 months →"</span>, hjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>, vjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"End-of-Sample Behavior"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Different methods behave differently at the end of the series"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Date"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Index"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Method"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced-methods_files/figure-html/end-sample-1.png" width="768"></p>
<p><strong>Key insights</strong>: - MA has NAs at the end (needs future
data) - HP, Kalman, and LOESS all provide estimates at the end - Kalman
filter often handles the end-of-sample best</p>
</div>
<div class="section level2">
<h2 id="method-selection-guide">Method Selection Guide<a class="anchor" aria-label="anchor" href="#method-selection-guide"></a>
</h2>
<div class="section level3">
<h3 id="decision-tree">Decision Tree<a class="anchor" aria-label="anchor" href="#decision-tree"></a>
</h3>
<ol style="list-style-type: decimal">
<li>
<strong>Does your data have seasonality?</strong>
<ul>
<li>Yes → Use <strong>STL</strong>
</li>
<li>No → Continue to step 2</li>
</ul>
</li>
<li>
<strong>Do you need to preserve peaks/valleys?</strong>
<ul>
<li>Yes → Use <strong>Savitzky-Golay</strong> or
<strong>LOESS</strong>
</li>
<li>No → Continue to step 3</li>
</ul>
</li>
<li>
<strong>Is this for business cycle analysis?</strong>
<ul>
<li>Yes → Use <strong>HP filter</strong> (see economic-filters
vignette)</li>
<li>No → Continue to step 4</li>
</ul>
</li>
<li>
<strong>Do you need maximum flexibility?</strong>
<ul>
<li>Yes → Use <strong>LOESS</strong> or <strong>Spline</strong>
</li>
<li>No → Continue to step 5</li>
</ul>
</li>
<li>
<strong>Do you want statistically optimal smoothing?</strong>
<ul>
<li>Yes → Use <strong>Kalman filter</strong>
</li>
<li>No → Use <strong>Moving Average</strong> or <strong>HP
filter</strong>
</li>
</ul>
</li>
</ol>
</div>
<div class="section level3">
<h3 id="method-summary-table">Method Summary Table<a class="anchor" aria-label="anchor" href="#method-summary-table"></a>
</h3>
<table class="table">
<thead><tr class="header">
<th>Method</th>
<th>Seasonality</th>
<th>Peaks</th>
<th>Flexibility</th>
<th>Speed</th>
<th>Complexity</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>STL</strong></td>
<td>✓</td>
<td>Medium</td>
<td>Medium</td>
<td>Fast</td>
<td>Low</td>
</tr>
<tr class="even">
<td><strong>Kalman</strong></td>
<td>-</td>
<td>Medium</td>
<td>Medium</td>
<td>Fast</td>
<td>Medium</td>
</tr>
<tr class="odd">
<td><strong>Savitzky-Golay</strong></td>
<td>-</td>
<td>✓</td>
<td>High</td>
<td>Fast</td>
<td>Medium</td>
</tr>
<tr class="even">
<td><strong>LOESS</strong></td>
<td>-</td>
<td>✓</td>
<td>High</td>
<td>Slow</td>
<td>Low</td>
</tr>
<tr class="odd">
<td><strong>Spline</strong></td>
<td>-</td>
<td>Medium</td>
<td>Very High</td>
<td>Fast</td>
<td>High</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="parameter-quick-reference">Parameter Quick Reference<a class="anchor" aria-label="anchor" href="#parameter-quick-reference"></a>
</h3>
<p><strong>STL</strong>:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Default works well for most seasonal data</span></span>
<span><span class="va">data</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/augment_trends.html">augment_trends</a></span><span class="op">(</span>value_col <span class="op">=</span> <span class="st">"value"</span>, methods <span class="op">=</span> <span class="st">"stl"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Adjust window for seasonal component</span></span>
<span><span class="va">data</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/augment_trends.html">augment_trends</a></span><span class="op">(</span></span>
<span>  value_col <span class="op">=</span> <span class="st">"value"</span>,</span>
<span>  methods <span class="op">=</span> <span class="st">"stl"</span>,</span>
<span>  window <span class="op">=</span> <span class="fl">13</span>  <span class="co"># Must be odd</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>Kalman</strong>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Light smoothing</span></span>
<span><span class="va">data</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/augment_trends.html">augment_trends</a></span><span class="op">(</span>value_col <span class="op">=</span> <span class="st">"value"</span>, methods <span class="op">=</span> <span class="st">"kalman"</span>, smoothing <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Heavy smoothing</span></span>
<span><span class="va">data</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/augment_trends.html">augment_trends</a></span><span class="op">(</span>value_col <span class="op">=</span> <span class="st">"value"</span>, methods <span class="op">=</span> <span class="st">"kalman"</span>, smoothing <span class="op">=</span> <span class="fl">5.0</span><span class="op">)</span></span></code></pre></div>
<p><strong>Savitzky-Golay</strong>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Standard setup</span></span>
<span><span class="va">data</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/augment_trends.html">augment_trends</a></span><span class="op">(</span></span>
<span>  value_col <span class="op">=</span> <span class="st">"value"</span>,</span>
<span>  methods <span class="op">=</span> <span class="st">"sg"</span>,</span>
<span>  window <span class="op">=</span> <span class="fl">9</span>,  <span class="co"># Must be odd</span></span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sg_poly_order <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>LOESS</strong>:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Flexible (less smooth)</span></span>
<span><span class="va">data</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/augment_trends.html">augment_trends</a></span><span class="op">(</span>value_col <span class="op">=</span> <span class="st">"value"</span>, methods <span class="op">=</span> <span class="st">"loess"</span>, smoothing <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Balanced</span></span>
<span><span class="va">data</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/augment_trends.html">augment_trends</a></span><span class="op">(</span>value_col <span class="op">=</span> <span class="st">"value"</span>, methods <span class="op">=</span> <span class="st">"loess"</span>, smoothing <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Smooth</span></span>
<span><span class="va">data</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/augment_trends.html">augment_trends</a></span><span class="op">(</span>value_col <span class="op">=</span> <span class="st">"value"</span>, methods <span class="op">=</span> <span class="st">"loess"</span>, smoothing <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span></span></code></pre></div>
<p><strong>Spline</strong>:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Default usually works well</span></span>
<span><span class="va">data</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/augment_trends.html">augment_trends</a></span><span class="op">(</span>value_col <span class="op">=</span> <span class="st">"value"</span>, methods <span class="op">=</span> <span class="st">"spline"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="common-pitfalls">Common Pitfalls<a class="anchor" aria-label="anchor" href="#common-pitfalls"></a>
</h2>
<div class="section level3">
<h3 id="pitfall-1-using-stl-on-non-seasonal-data">Pitfall 1: Using STL on Non-Seasonal Data<a class="anchor" aria-label="anchor" href="#pitfall-1-using-stl-on-non-seasonal-data"></a>
</h3>
<p><strong>Problem</strong>: STL fails or gives weird results
<strong>Solution</strong>: Check if data actually has seasonality. Use
ACF plot or visual inspection.</p>
</div>
<div class="section level3">
<h3 id="pitfall-2-loess-too-flexible">Pitfall 2: LOESS Too Flexible<a class="anchor" aria-label="anchor" href="#pitfall-2-loess-too-flexible"></a>
</h3>
<p><strong>Problem</strong>: Trend tracks data too closely, includes
noise <strong>Solution</strong>: Increase span parameter (try 0.3-0.5
instead of 0.1-0.2)</p>
</div>
<div class="section level3">
<h3 id="pitfall-3-kalman-divergence">Pitfall 3: Kalman Divergence<a class="anchor" aria-label="anchor" href="#pitfall-3-kalman-divergence"></a>
</h3>
<p><strong>Problem</strong>: Kalman filter produces unrealistic trends
<strong>Solution</strong>: Increase smoothing parameter or check data
for outliers</p>
</div>
<div class="section level3">
<h3 id="pitfall-4-overfitting-with-splines">Pitfall 4: Overfitting with Splines<a class="anchor" aria-label="anchor" href="#pitfall-4-overfitting-with-splines"></a>
</h3>
<p><strong>Problem</strong>: Spline trend is too wiggly
<strong>Solution</strong>: Splines are very flexible - sometimes simpler
methods are better</p>
</div>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>Advanced methods provide powerful alternatives to standard
approaches:</p>
<ul>
<li>
<strong>STL</strong>: The go-to method for seasonal data</li>
<li>
<strong>Kalman</strong>: Statistically optimal, great for real-time
filtering</li>
<li>
<strong>Savitzky-Golay</strong>: Preserves local features better
than MA</li>
<li>
<strong>LOESS</strong>: Flexible, data-adaptive smoothing</li>
<li>
<strong>Spline</strong>: Maximum flexibility when you need it</li>
</ul>
<p><strong>Best practices</strong>: - Start simple (MA or HP) before
trying advanced methods - Compare multiple methods to ensure robustness
- Visualize results - don’t just trust the numbers - Consider the
trade-off between smoothness and responsiveness</p>
</div>
<div class="section level2">
<h2 id="further-reading">Further Reading<a class="anchor" aria-label="anchor" href="#further-reading"></a>
</h2>
<ul>
<li>For basic methods: See “Getting Started” vignette</li>
<li>For moving averages: See “Moving Averages” vignette</li>
<li>For business cycles: See “Economic Filters” vignette</li>
<li>For STL details: <code><a href="https://rdrr.io/r/stats/stl.html" class="external-link">?stats::stl</a></code>
</li>
<li>For Kalman filtering: <code><a href="https://rdrr.io/pkg/dlm/man/dlmSmooth.html" class="external-link">?dlm::dlmSmooth</a></code>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li>Cleveland, R. B., Cleveland, W. S., McRae, J. E., &amp; Terpenning,
I. (1990). STL: A seasonal-trend decomposition. <em>Journal of Official
Statistics</em>, 6(1), 3-73.</li>
<li>Kalman, R. E. (1960). A new approach to linear filtering and
prediction problems. <em>Journal of Basic Engineering</em>, 82(1),
35-45.</li>
<li>Cleveland, W. S. (1979). Robust locally weighted regression and
smoothing scatterplots. <em>Journal of the American Statistical
Association</em>, 74(368), 829-836.</li>
<li>Savitzky, A., &amp; Golay, M. J. (1964). Smoothing and
differentiation of data by simplified least squares procedures.
<em>Analytical Chemistry</em>, 36(8), 1627-1639.</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Vinicius Oike.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
