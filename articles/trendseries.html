<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Getting Started with trendseries • trendseries</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Getting Started with trendseries">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">trendseries</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/trendseries.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/economic-filters.html">Economic Filters for Business Cycle Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/moving-averages.html">Moving Averages for Trend Analysis</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/viniciusoike/trendseries/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Getting Started with trendseries</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/viniciusoike/trendseries/blob/main/vignettes/trendseries.Rmd" class="external-link"><code>vignettes/trendseries.Rmd</code></a></small>
      <div class="d-none name"><code>trendseries.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="what-is-trendseries">What is trendseries?<a class="anchor" aria-label="anchor" href="#what-is-trendseries"></a>
</h2>
<p>The <code>trendseries</code> package helps you extract trends from
economic time series data. Trends can be broadly understood as the
underlying “direction” of the data, when stripped of its noise and
seasonal patterns.</p>
<p>The goal of <code>trendseries</code> is to provide a modern,
pipe-friendly interface for exploratory analysis of time series data in
conventional <code>data.frame</code> format. Throughout this vignette,
the terms <code>data.frame</code> and “data frame” will refer to any
dataset in a rectangular format, i.e.,
<code>data.frame</code>/<code>tibble</code>/<code>data.table</code>.</p>
<p>Working with time series can be quite cumbersome in R. Individual
time series are treated as a specific S3 class called <code>ts</code>.
While base R comes with a strong suite of built-in functions for
time-series analysis it’s hard to adapt this workflow with “modern R”
which revolves around data frames.</p>
<p>Tabular data frames are the most common format for time series data
in R, but most trend extraction methods are designed for <code>ts</code>
objects. <code>trendseries</code> aims to bridge this gap, allowing you
to work directly with data frames without time-consuming conversions
between <code>ts</code> and <code>data.frame</code>.
<code>trendseries</code> was designed to work fluidly with
<code>tidyverse</code> tools like <code>dplyr</code> and
<code>ggplot2</code>.</p>
<p>This package was designed with economic time series in mind, in this
sense, it includes methods commonly used in economics (e.g.,
Hodrick-Prescott filter) as well as general-purpose smoothing methods
(e.g., LOESS, moving averages).</p>
</div>
<div class="section level2">
<h2 id="getting-started">Getting started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<p><code>trendseries</code> revolves around a general wrapper function
<code>augment_trends</code> that adds news columns to a data frame.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/viniciusoike/trendseries" class="external-link">trendseries</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">theme_series</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span>paper <span class="op">=</span> <span class="st">"#fefefe"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>    panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    <span class="co"># Use colors</span></span>
<span>    palette.colour.discrete <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="st">"#2c3e50"</span>,</span>
<span>        <span class="st">"#e74c3c"</span>,</span>
<span>        <span class="st">"#f39c12"</span>,</span>
<span>        <span class="st">"#1abc9c"</span>,</span>
<span>        <span class="st">"#9b59b6"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>This dataset contains monthly electric consumption for Brazilian
households from 1979 to 2025.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">electric</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 2</span></span></span>
<span><span class="co">#&gt;   date       consumption</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1979-02-01        <span style="text-decoration: underline;">1</span>647</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1979-03-01        <span style="text-decoration: underline;">1</span>736</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 1979-04-01        <span style="text-decoration: underline;">1</span>681</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 1979-05-01        <span style="text-decoration: underline;">1</span>757</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 1979-06-01        <span style="text-decoration: underline;">1</span>689</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 1979-07-01        <span style="text-decoration: underline;">1</span>730</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">electric</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">consumption</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">theme_series</span></span></code></pre></div>
<p><img src="trendseries_files/figure-html/unnamed-chunk-3-1.png" class="r-plt" width="672"></p>
<p>To find the trend in data we use <code>augment_trends</code> and
select a method: in this case, STL (see <code><a href="https://rdrr.io/r/stats/stl.html" class="external-link">stats::stl</a></code>). We
also need to inform the names of the date column (“date” as default) and
the value column (“value”) as default.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">elec_trend</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/augment_trends.html">augment_trends</a></span><span class="op">(</span></span>
<span>  <span class="va">electric</span>,</span>
<span>  value_col <span class="op">=</span> <span class="st">"consumption"</span>,</span>
<span>  methods <span class="op">=</span> <span class="st">"stl"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">elec_trend</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   date       consumption trend_stl</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1979-02-01        <span style="text-decoration: underline;">1</span>647     <span style="text-decoration: underline;">1</span>666.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1979-03-01        <span style="text-decoration: underline;">1</span>736     <span style="text-decoration: underline;">1</span>688.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 1979-04-01        <span style="text-decoration: underline;">1</span>681     <span style="text-decoration: underline;">1</span>710.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 1979-05-01        <span style="text-decoration: underline;">1</span>757     <span style="text-decoration: underline;">1</span>726.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 1979-06-01        <span style="text-decoration: underline;">1</span>689     <span style="text-decoration: underline;">1</span>743.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 1979-07-01        <span style="text-decoration: underline;">1</span>730     <span style="text-decoration: underline;">1</span>758.</span></span></code></pre></div>
<p><code>augment_trends</code> will do its best to try to infer the
appropriate frequency but this information can be supplied manually.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">elec_trend</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/augment_trends.html">augment_trends</a></span><span class="op">(</span></span>
<span>  <span class="va">electric</span>,</span>
<span>  date_col <span class="op">=</span> <span class="st">"date"</span>,</span>
<span>  value_col <span class="op">=</span> <span class="st">"consumption"</span>,</span>
<span>  methods <span class="op">=</span> <span class="st">"stl"</span>,</span>
<span>  frequency <span class="op">=</span> <span class="fl">12</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>There are two options to visualize the data using
<code>ggplot2</code>. The first is to convert the data to a “long”
format.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Prepare data for plotting</span></span>
<span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="va">elec_trend</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="op">-</span><span class="va">date</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"series"</span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"value"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    series <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">series</span> <span class="op">==</span> <span class="st">"consumption"</span> <span class="op">~</span> <span class="st">"Data (original)"</span>,</span>
<span>      <span class="va">series</span> <span class="op">==</span> <span class="st">"trend_stl"</span> <span class="op">~</span> <span class="st">"Trend (STL)"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Create the plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">plot_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">series</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Residential Electricity Consumption"</span>,</span>
<span>    x <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Electric Consumption (GWh)"</span>,</span>
<span>    color <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">theme_series</span></span></code></pre></div>
<p><img src="trendseries_files/figure-html/unnamed-chunk-6-1.png" class="r-plt" width="672"></p>
<p>An alternative is to simply add the trend as an additional
<code>geom_line</code> layer. While this method is typically quicker, it
doesn’t produce a color legend. Depending on the audience of the plot,
however, it might be intuitive that the smooth line on top is the trend
and that the other line is the raw data.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">elec_trend</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">consumption</span><span class="op">)</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"#024873FF"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">trend_stl</span><span class="op">)</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"#024873FF"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Residential Electricity Consumption"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Decomposition using a STL trend"</span>,</span>
<span>    x <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Electric Consumption (GWh)"</span>,</span>
<span>    color <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">theme_series</span></span></code></pre></div>
<p><img src="trendseries_files/figure-html/unnamed-chunk-7-1.png" class="r-plt" width="672"></p>
<div class="section level3">
<h3 id="multiple-time-series">Multiple time series<a class="anchor" aria-label="anchor" href="#multiple-time-series"></a>
</h3>
<p><code>trendseries</code> makes it easy to compute trends across
several series. One or more grouping columns can be selected through the
<code>group_vars</code> argument.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cities</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Houston"</span>, <span class="st">"San Antonio"</span>, <span class="st">"Dallas"</span>, <span class="st">"Austin"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">txtrend</span> <span class="op">&lt;-</span> <span class="va">txhousing</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">city</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">cities</span>, <span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">2010</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/make_datetime.html" class="external-link">make_date</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/augment_trends.html">augment_trends</a></span><span class="op">(</span></span>
<span>    value_col <span class="op">=</span> <span class="st">"median"</span>,</span>
<span>    group_vars <span class="op">=</span> <span class="st">"city"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">txtrend</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">median</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>, color <span class="op">=</span> <span class="st">"#024873FF"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">trend_stl</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"#024873FF"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">city</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">theme_series</span></span></code></pre></div>
<p><img src="trendseries_files/figure-html/unnamed-chunk-8-1.png" class="r-plt" width="672"></p>
</div>
<div class="section level3">
<h3 id="multiple-trend-methods">Multiple trend methods<a class="anchor" aria-label="anchor" href="#multiple-trend-methods"></a>
</h3>
<p><code>trendseries</code> also facilitates extracting trends with
different methods simultaneously. The next example uses a chained index
of retail sales of automotive fuel in the UK. The original data comes
from the UK Office for National Statistics.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">retail_autofuel</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">0.8</span>, color <span class="op">=</span> <span class="st">"#024873FF"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">theme_series</span></span></code></pre></div>
<p><img src="trendseries_files/figure-html/unnamed-chunk-9-1.png" class="r-plt" width="672"></p>
<p>This example also highlights how <code>augment_trends</code> fits
neatly in a pipe workflow.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fuel_trends</span> <span class="op">&lt;-</span> <span class="va">retail_autofuel</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">&gt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2012-01-01"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/augment_trends.html">augment_trends</a></span><span class="op">(</span></span>
<span>    methods <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"stl"</span>, <span class="st">"hp"</span>, <span class="st">"loess"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">comparison_plot</span> <span class="op">&lt;-</span> <span class="va">fuel_trends</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">value</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"trend_"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"method"</span>,</span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    method <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"value"</span> <span class="op">~</span> <span class="st">"Data (original)"</span>,</span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"trend_hp"</span> <span class="op">~</span> <span class="st">"HP Filter"</span>,</span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"trend_stl"</span> <span class="op">~</span> <span class="st">"STL"</span>,</span>
<span>      <span class="va">method</span> <span class="op">==</span> <span class="st">"trend_loess"</span> <span class="op">~</span> <span class="st">"LOESS"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">comparison_plot</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Comparing Different Trend Extraction Methods"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Same data, different methods"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Date"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Construction Index"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Method"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">theme_series</span></span></code></pre></div>
<p><img src="trendseries_files/figure-html/compare-methods-1.png" class="r-plt" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="finer-control">Finer control<a class="anchor" aria-label="anchor" href="#finer-control"></a>
</h2>
<p>Filter-extraction methods are spread across different packages and
thus use different conventions for parameter names.
<code>trendseries</code> tries to simplify this when possible. Methods
like moving averages and moving medians have a shared “window” argument
that defines the size of the rolling window.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">elec_trends</span> <span class="op">&lt;-</span> <span class="va">electric</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>value <span class="op">=</span> <span class="va">consumption</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># window controls the s.window argument by default</span></span>
<span>  <span class="fu"><a href="../reference/augment_trends.html">augment_trends</a></span><span class="op">(</span>methods <span class="op">=</span> <span class="st">"stl"</span>, window <span class="op">=</span> <span class="fl">17</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Creates a 11-month moving median</span></span>
<span>  <span class="fu"><a href="../reference/augment_trends.html">augment_trends</a></span><span class="op">(</span>methods <span class="op">=</span> <span class="st">"median"</span>, window <span class="op">=</span> <span class="fl">11</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Creates a (centerd) 5-month moving average</span></span>
<span>  <span class="fu"><a href="../reference/augment_trends.html">augment_trends</a></span><span class="op">(</span>methods <span class="op">=</span> <span class="st">"ma"</span>, window <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Creates a (centered) 2x12 moving average</span></span>
<span>  <span class="fu"><a href="../reference/augment_trends.html">augment_trends</a></span><span class="op">(</span>methods <span class="op">=</span> <span class="st">"ma"</span>, window <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span></code></pre></div>
<p><img src="trendseries_files/figure-html/unnamed-chunk-11-1.png" class="r-plt" width="672"></p>
<p><code>trendseries</code> tries to simplify trend extraction but this
necessarily comes at a cost of lost of precision. For instance, the
<code><a href="https://rdrr.io/r/stats/stl.html" class="external-link">stats::stl</a></code> function has both a <code>t.window</code> and
<code>s.window</code> arguments. The <code>window</code> argument
assumes the user wants to control the <code>s.window</code> argument.
This case illustrates how trendseries tries to simplify the workflow by
being opinionated about default user choices.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="va">electric</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/augment_trends.html">augment_trends</a></span><span class="op">(</span></span>
<span>    value_col <span class="op">=</span> <span class="st">"consumption"</span>,</span>
<span>    methods <span class="op">=</span> <span class="st">"stl"</span>,</span>
<span>    window <span class="op">=</span> <span class="fl">21</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="va">electric</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/augment_trends.html">augment_trends</a></span><span class="op">(</span></span>
<span>    value_col <span class="op">=</span> <span class="st">"consumption"</span>,</span>
<span>    methods <span class="op">=</span> <span class="st">"stl"</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>s.window <span class="op">=</span> <span class="fl">21</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="how-is-trendseries-easier-than-the-traditional-workflow">How is <code>trendseries</code> easier than the traditional
workflow?<a class="anchor" aria-label="anchor" href="#how-is-trendseries-easier-than-the-traditional-workflow"></a>
</h2>
<p>Time series have a specific structure in R (<code>ts</code>) and most
filtering methods are designed for <code>ts</code> objects. However,
datasets come as data frames with date columns, which can make applying
filters cumbersome.</p>
<p>The usual workflow involves (1) converting individual columns to
<code>ts</code>, (2) applying the filter, (3) and then converting back
to a <code>data.frame</code>. This can be cumbersome, especially when
working with multiple series or grouped data. Merging back the results
with the original data can also be error-prone due to misalignment of
dates and additional <code>NA</code> values introduced by some
filters.</p>
<p>For instance, building an HP filter estimate of
<code>gdp_construction</code>, without <code>trendseries</code> requires
one to first convert the data frame to a <code>ts</code> object,
mannually inputing both <code>frequency</code> and <code>start</code>
parameters:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gdp_cons</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ts.html" class="external-link">ts</a></span><span class="op">(</span></span>
<span>  <span class="va">gdp_construction</span><span class="op">$</span><span class="va">index</span>,</span>
<span>  frequency <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1996</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Or, using lubridate to extract year and month</span></span>
<span><span class="va">gdp_cons</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ts.html" class="external-link">ts</a></span><span class="op">(</span></span>
<span>  <span class="va">gdp_construction</span><span class="op">$</span><span class="va">index</span>,</span>
<span>  frequency <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html" class="external-link">year</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">gdp_construction</span><span class="op">$</span><span class="va">date</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/quarter.html" class="external-link">quarter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">gdp_construction</span><span class="op">$</span><span class="va">date</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Then applying the HP filter using the <code>mFilter</code>
package.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gdp_trend_hp</span> <span class="op">&lt;-</span> <span class="fu">mFilter</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mFilter/man/hpfilter.html" class="external-link">hpfilter</a></span><span class="op">(</span><span class="va">gdp_cons</span>, <span class="fl">1600</span><span class="op">)</span></span></code></pre></div>
<p>And finally, converting it back to a <code>data.frame</code> and
merging it with the original data.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Convert back to data frame using tsbox</span></span>
<span><span class="va">trend_df</span> <span class="op">&lt;-</span> <span class="fu">tsbox</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/tsbox/reference/ts_ts.html" class="external-link">ts_df</a></span><span class="op">(</span><span class="va">gdp_trend_hp</span><span class="op">$</span><span class="va">trend</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">trend_df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"date"</span>, <span class="st">"trend_hp"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Join with original data</span></span>
<span><span class="va">gdp_manual</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">gdp_construction</span>, <span class="va">trend_df</span>, by <span class="op">=</span> <span class="st">"date"</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="what-are-the-alternatives-to-trendseries">What are the alternatives to <code>trendseries</code>?<a class="anchor" aria-label="anchor" href="#what-are-the-alternatives-to-trendseries"></a>
</h3>
<p>The closest alternative to <code>trendseries</code> is the
<code>tsibble</code>/<code>fable</code> ecosystem, which provides a
<code>model()</code> function for applying models — including some trend
extraction methods — to grouped time series. Like
<code>trendseries</code>, these packages integrate well with
<code>tidyverse</code> tools and pipes.</p>
<p>However, <code>fable</code> was designed primarily for forecasting,
which means its trend extraction capabilities are more limited. They
also lack some popular methods commonly used by economists, such as the
HP filter and the Hamilton filter.</p>
<p>Additionally, these packages require using the <code>tsibble</code>
data structure, which pulls users away from the familiar
<code>data.frame</code>/<code>tibble</code> format. For users working
with just a few time series and relying on R’s built-in <code>ts</code>
functionality, the <code>tsibble</code> structure can feel unnecessarily
complex.</p>
</div>
<div class="section level3">
<h3 id="acknowledgements">Acknowledgements<a class="anchor" aria-label="anchor" href="#acknowledgements"></a>
</h3>
<p>This package was inspired by the need for a simpler workflow for
trend extraction in R. It builds upon many existing packages,
including:</p>
<ul>
<li>
<code>mFilter</code> for economic filters.</li>
<li>
<code>hpfilter</code> for Hodrick-Prescott filtering.</li>
<li>
<code>tsbox</code> for time series conversions.</li>
</ul>
</div>
<div class="section level3">
<h3 id="getting-help">Getting Help<a class="anchor" aria-label="anchor" href="#getting-help"></a>
</h3>
<p>If you run into issues:</p>
<ul>
<li>Check the documentation: <code><a href="../reference/augment_trends.html">?augment_trends</a></code>
</li>
<li>View examples: <code>example(augment_trends)</code>
</li>
<li>Read other vignettes:
<code>vignette(package = "trendseries")</code>
</li>
<li>Report bugs: GitHub issues</li>
</ul>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Vinicius Oike.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
